{% extends "base.html" %}

{% block title %}Lista de Pedidos{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Lista de Pedidos</h2>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Fecha</th>
                <th>Estado del Pedido</th>
                <th>Estado del Pago</th>
                <th>Total</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for pedido in pedidos %}
            <tr>
                <td>{{ pedido.id }}</td>
                <td>{{ pedido.usuario }}</td>
                <td>{{ pedido.fecha }}</td>
                <td>{{ pedido.estado }}</td>
                <td>
                    {% if pedido.pago %}
                        {{ pedido.pago.estado }}
                    {% else %}
                        <span class="text-muted">Sin registro</span>
                    {% endif %}
                </td>
                <td>${{ pedido.total }}</td>
                <td>
                    {% if user.is_superuser %}
                        <form method="post" action="{% url 'pedidos:cambiar_estado_pedido' pedido.id 'dummy' %}" style="display:inline;">
                            {% csrf_token %}
                            <select name="nuevo_estado" onchange="this.form.action=this.form.action.replace('dummy', this.value); this.form.submit();" class="form-select form-select-sm d-inline w-auto">
                                <option disabled selected>Cambiar estado</option>
                                <option value="Pendiente">Pendiente</option>
                                <option value="Pagado">Pagado</option>
                                <option value="Enviado">Enviado</option>
                                <option value="Entregado">Entregado</option>
                                <option value="Cancelado">Cancelado</option>
                            </select>
                        </form>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center">No hay pedidos registrados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
